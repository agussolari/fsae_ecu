/***************************************************************************//**
  @file     millis.c
  @brief    Milliseconds counter library
  @author   Nicol√°s Magliola
 ******************************************************************************/

/*******************************************************************************
 * INCLUDE HEADER FILES
 ******************************************************************************/

#include "millis.h"

#include "SysTick.h"


/*******************************************************************************
 * CONSTANT AND MACRO DEFINITIONS USING #DEFINE
 ******************************************************************************/

/*******************************************************************************
 * ENUMERATIONS AND STRUCTURES AND TYPEDEFS
 ******************************************************************************/

/*******************************************************************************
 * VARIABLES WITH GLOBAL SCOPE
 ******************************************************************************/

/*******************************************************************************
 * FUNCTION PROTOTYPES FOR PRIVATE FUNCTIONS WITH FILE LEVEL SCOPE
 ******************************************************************************/

static void millis_pisr(void);


/*******************************************************************************
 * ROM CONST VARIABLES WITH FILE LEVEL SCOPE
 ******************************************************************************/

/*******************************************************************************
 * STATIC VARIABLES AND CONST VARIABLES WITH FILE LEVEL SCOPE
 ******************************************************************************/

static volatile uint32_t millis_cnt;


/*******************************************************************************
 *******************************************************************************
                        GLOBAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/

void millis_init(void)
{
	SysTick_Init();
	SysTick_RegisterCallback(millis_pisr, 1);
}


uint32_t millis(void)
{
	return millis_cnt;
}


void delay(uint32_t ms)
{
	ms += millis_cnt;

	while (ms < millis_cnt)
	{
		// wait (do nothing)
	}
}



/*******************************************************************************
 *******************************************************************************
                        LOCAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/

static void millis_pisr(void)
{
#if SYSTICK_ISR_FREQUENCY_HZ == 1000
	++millis_cnt;
#else
#error no Messirve
#endif // TIMER_TICK_MS == xx
}




/******************************************************************************/
